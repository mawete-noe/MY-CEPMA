<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>MYCEPMA Search</title>
<link rel="shortcut icon" href="logo my cepma/logo my cepma bp.png" type="image/x-icon">

<!-- √çcones online -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body { 
  background: #0d1117; 
  color: #e5e7eb; 
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; 
  margin: 0; 
  padding: 0; 
  display: flex; 
  justify-content: center; 
  min-height: 100vh;
}

/* BOT√ÉO VOLTAR */
.btn-voltar{
  position: fixed;
  top: 20px;
  left: 20px;
  background: #1f2937;
  color: #60a5fa;
  padding: 10px 18px;
  border-radius: 12px;
  text-decoration: none;
  font-weight: bold;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.4);
  transition: 0.3s;
  z-index: 999;
}

.btn-voltar:hover{
  background: #60a5fa;
  color: #0d1117;
  transform: translateY(-2px);
}

.chat { 
  width: 95%; 
  max-width: 900px; 
  margin: 80px auto 20px auto; 
  padding: 25px; 
  background: #161b2a; 
  border-radius: 20px; 
  box-shadow: 0 10px 25px rgba(0,0,0,0.5); 
  display:flex; 
  flex-direction:column; 
  height: 90vh;
}

h2 { 
  text-align: center; 
  font-size: 2rem; 
  margin-bottom: 15px; 
  color: #60a5fa;
}

#mensagens { 
  background: #1f2937; 
  flex:1; 
  overflow-y:auto; 
  padding:20px; 
  border-radius:15px; 
  border:1px solid #334155; 
  display:flex; 
  flex-direction:column;
}

.msg { 
  margin-bottom:16px; 
  line-height:1.6; 
  padding:12px 15px; 
  border-radius:12px; 
  word-wrap:break-word; 
  max-width:85%;
}

.user { 
  color: #38bdf8; 
  background: rgba(56,189,248,0.1); 
  align-self: flex-end; 
}

.bot { 
  color: #a7f3d0; 
  background: rgba(15,23,42,0.7); 
  align-self: flex-start; 
}

.loading-box { 
  margin-top:10px; 
}

.progress { 
  width:100%; 
  height:16px; 
  background:#0d1117; 
  border-radius:8px; 
  overflow:hidden; 
  margin-top:8px; 
  border:1px solid #334155; 
}

.progress-bar { 
  height:100%; 
  width:0%; 
  background:linear-gradient(90deg,#38bdf8,#a7f3d0); 
  transition:width 0.4s ease; 
}

.input-area { 
  display:flex; 
  gap:8px; 
  margin-top:15px; 
  flex-wrap:wrap; 
}

input { 
  flex:1 1 200px; 
  padding:12px; 
  border:none; 
  outline:none; 
  border-radius:10px; 
  font-size:1rem; 
  background:#1f2937; 
  color:#f0f0f0; 
}

button { 
  padding:12px 16px; 
  border:none; 
  border-radius:10px; 
  background:#22c55e; 
  color:white; 
  cursor:pointer; 
  font-weight:bold; 
  transition:0.2s;
  flex:1 1 80px; 
}

button:hover {
  background:#16a34a; 
}

button.clear { 
  background:cyan; 
}

button.clear:hover { 
  background:#b91c1c; 
}

.fonte { 
  font-size:12px; 
  opacity:0.85; 
  margin-top:6px; 
}

a { 
  color:#60a5fa; 
  text-decoration:underline; 
}

@media(max-width:480px){
  .btn-voltar{
    top: 10px;
    left: 10px;
    padding: 8px 14px;
    font-size: 0.85rem;
  }

  .chat{
    margin-top:70px;
    height:95vh;
    padding:15px;
  }

  h2{
    font-size:1.3rem;
  }

  input{
    font-size:0.9rem;
    padding:8px;
  }

  button{
    font-size:0.9rem;
    padding:5px;
  }

  .msg{
    max-width:95%;
    font-size:0.9rem;
    padding:10px;
  }
}
</style>
</head>

<body>

<!-- BOT√ÉO VOLTAR -->
<a href="index.html" class="btn-voltar">
  <i class="fas fa-arrow-left"></i>
 
</a>

<div class="chat">
<h2>ü§ñ MYCEPMA Search</h2>
<div id="mensagens"></div>

<div class="input-area">
<input id="pergunta" placeholder="Pergunte qualquer coisa..." />
<button onclick="enviar()">Enviar</button>
<button onclick="regenerar()">
  <img src="logo my cepma/icon/regenerar.png" width="40px">
</button>
<button class="clear" onclick="limparChat()">
  <img src="logo my cepma/icon/lixo1.png" width="40px">
</button>
</div>
</div>

<script>
const mensagens = document.getElementById("mensagens");
let ultimaPergunta = "";
let usuario = localStorage.getItem("usuario") || "";

if(!usuario){
  usuario = prompt("Ol√°! Qual √© o seu nome?");
  if(!usuario) usuario="Voc√™";
  localStorage.setItem("usuario",usuario);
}

mensagens.innerHTML = localStorage.getItem("chat") || "";

/* ===== Fun√ß√£o adicionar mensagem ===== */
function adicionar(tipo, html){
  const div=document.createElement("div");
  div.className=`msg ${tipo}`;
  div.innerHTML=html;
  mensagens.appendChild(div);
  mensagens.scrollTop=mensagens.scrollHeight;
  localStorage.setItem("chat",mensagens.innerHTML);
}

/* ===== Voz feminina ===== */
let vozes=[];
function carregarVozes(){vozes=speechSynthesis.getVoices().filter(v=>v.lang.includes("pt"));}
speechSynthesis.onvoiceschanged=carregarVozes;

function falar(texto){
  if(!("speechSynthesis"in window))return;
  speechSynthesis.cancel();
  const fala=new SpeechSynthesisUtterance(texto);
  fala.lang="pt-BR";
  fala.voice=vozes.find(v=>/female|feminino/i.test(v.name))||vozes[0]||null;
  speechSynthesis.speak(fala);
}

/* ===== Pesquisas ===== */
async function pesquisarWikipedia(pergunta){
  try{
    const searchUrl=`https://pt.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(pergunta)}&format=json&origin=*`;
    const searchRes=await fetch(searchUrl);
    const searchData=await searchRes.json();
    if(!searchData.query.search.length)return null;
    const titulo=searchData.query.search[0].title;
    const summaryUrl=`https://pt.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(titulo)}`;
    const summaryRes=await fetch(summaryUrl);
    if(!summaryRes.ok)return null;
    const summaryData=await summaryRes.json();
    return {texto:summaryData.extract, link:summaryData.content_urls.desktop.page, fonte:`Wikipedia ‚Äî ${titulo}`};
  }catch{return null;}
}

function pesquisarGoogle(pergunta){
  return {texto:`O carregamento est√° demorando mais do que o esperado. Verifique sua conex√£o com a internet`, link:`https://www.google.com/search?q=${encodeURIComponent(pergunta)}`, fonte:`Google Chrome`};
}

function resumir(texto){
  if(!texto) return texto;
  const frases=texto.split(". ");
  return frases.slice(0,4).join(". ") + ".";
}

async function responderPergunta(pergunta){
  const loading=document.createElement("div");
  loading.className="msg bot";
  loading.innerHTML=`<strong>MYCEPMA Search:</strong><br>üîç Pesquisando...`;
  mensagens.appendChild(loading);
  mensagens.scrollTop=mensagens.scrollHeight;

  let resultado=null;

  if(pergunta.toLowerCase().includes("quem te criou")){
    resultado={texto:"Eu fui criado pelos alunos do Complexo Escolar Privada Mpangui Afonso (CEPMA) Turma B 11¬∫ Classe Manh√£", link:"https://mycepma.netlify.app/sobre", fonte:"Informa√ß√£o especial"};
  } else {
    resultado=await pesquisarWikipedia(pergunta);
    if(!resultado) resultado=pesquisarGoogle(pergunta);
  }

  const textoResumo=resumir(resultado.texto);
  loading.innerHTML=`<strong>MYCEPMA Search:</strong><br>${textoResumo}<div class="fonte">Fonte: <a href="${resultado.link}" target="_blank">${resultado.fonte}</a></div>`;
  falar(textoResumo);
  localStorage.setItem("chat",mensagens.innerHTML);
}

async function enviar(){
  const input=document.getElementById("pergunta");
  const pergunta=input.value.trim();
  if(!pergunta)return;
  ultimaPergunta=pergunta;
  adicionar("user",`<strong>${usuario}:</strong><br>${pergunta}`);
  input.value="";
  await responderPergunta(pergunta);
}

async function regenerar(){
  if(ultimaPergunta) await responderPergunta(ultimaPergunta);
}

function limparChat(){
  if(!confirm("Apagar todas as perguntas e respostas?"))return;
  mensagens.innerHTML="";
  localStorage.removeItem("chat");
  ultimaPergunta="";
}
</script>

</body>
</html>